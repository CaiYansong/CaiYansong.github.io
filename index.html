<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>蔡延松的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="我的博客">
<meta property="og:type" content="website">
<meta property="og:title" content="蔡延松的博客">
<meta property="og:url" content="https://yansongcai.github.io/index.html">
<meta property="og:site_name" content="蔡延松的博客">
<meta property="og:description" content="我的博客">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="蔡延松">
<meta property="article:tag" content="蔡延松 延松 cys YansongCai caiyansong">
<meta name="twitter:card" content="summary">
  
  
    <link rel="icon" href="/favicon.ico">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">


<meta name="generator" content="Hexo 4.2.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header-wrap">
  <div id="header">
    <!-- <div class="brand-logo">
      <a href="/" class="waves-effect waves-light">
        
        <img src="/medias/logo.png" class="logo-img" alt="LOGO">
        
        <span class="logo-span">蔡延松的博客</span>
      </a>
    </div> -->

    <nav id="main-nav">
      <a id="main-nav-toggle" class="nav-icon"></a>
      
      <a class="main-nav-link" href="/">首页</a>
      
      <a class="main-nav-link" href="/archives">列表</a>
      
      <a class="main-nav-link" href="/about">关于</a>
      
    </nav>

    <div id="search-wrap" class="search-wrap">
      <div id="search-form-wrap" class="search-form-wrap">
        <form class="search-form">
          <input type="search" name="q" class="search-form-input" id="js_site_search_input" placeholder="Search"
            autocomplete="off">
            <img id="nav-search-btn" class="nav-icon" src="https://ss2.bdstatic.com/70cFvnSh_Q1YnxGkpoWK1HF6hhy/it/u=3748312416,1453574622&fm=15&gp=0.jpg" />
          <!-- <button type="submit" class="search-form-submit">&#xF002;</button> -->
        </form>
        <div id="js_site_search_result" class="local-search-result">
        </div>
      </div>
    </div>

    <!-- 自带的 google搜索 -->
    <!-- <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://yansongcai.github.io"></form>
      </div> -->

    <!-- 百度搜索 -->
    <!-- <div id="search-form-wrap">
        <form action="http://www.baidu.com/s?cl=3&" method="get" accept-charset="UTF-8" class="search-form">
          <input type="search" name="wd" class="search-form-input" placeholder="Search" />
          <button type="submit" class="search-form-submit">&#xF002;</button>
          <input type="hidden" name="si" value="https://yansongcai.github.io" />
        </form>
      </div> -->
</header>
      <div class="outer container">
        <section id="main">
  
    <article id="post-闭包" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/09/08/bi-bao/" class="article-date">
  <time datetime="2020-09-08T11:56:31.280Z" itemprop="datePublished">2020-09-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/09/08/bi-bao/">闭包</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a name="loGgS"></a></p>
<h1 id="概念"><a class="header-anchor" href="#概念">¶</a>概念</h1>
<blockquote>
<p>MDN:<br>
A <strong>closure</strong> is the combination of a function bundled together (enclosed) with references to its surrounding state (the <strong>lexical environment</strong>). In other words, a closure gives you access to an outer function’s scope from an inner function. In JavaScript, closures are created every time a function is created, at function creation time.</p>
</blockquote>
<p>函数和对其周围状态（<strong>lexical environment，词法环境</strong>）的引用捆绑在一起构成<strong>闭包</strong>。也就是说，闭包可以让你从内部函数访问外部函数作用域。在 JavaScript 中，每当函数被创建，就会在函数生成时生成闭包。</p>
<p>闭包是指有权访问另一个函数作用域中变量的函数，创建闭包的最常见的方式就是在一个函数内创建另一个函数，通过另一个函数访问这个函数的局部变量，利用闭包可以突破作用链域，将函数内部的变量和方法传递到外部。<br /></p>
<p><a name="Ea6NW"></a></p>
<h1 id="特性"><a class="header-anchor" href="#特性">¶</a>特性</h1>
<p>1.函数嵌套函数，父级函数 返回 子函数体 给全局。<br />2.子函数 访问 父级函数 的局部变量<br />3.变量不会被垃圾回收机制回收<br /><br>
<br />目的：把局部变量 变成 自由变量（生命周期永久的和页面同存）<br />作用：函数内部的变量可以在外部被访问<br /><br>
<br />⚠️ 函数嵌套函数+内部函数使用了外部函数的自由变量<br />⚠️ 函数嵌套了异步函数，该异步函数不算是内层函数。类似于setTimeout等异步函数中的回调函数，不算内层函数<br /><br>
<br /></p>
<p><a name="vCvmy"></a></p>
<h1 id="缺点"><a class="header-anchor" href="#缺点">¶</a>缺点</h1>
<p>常驻内存，会增大内存的使用量，使用不当会造成内存泄漏。<br /><br>
<br />闭包产生的变量不用了就赋值为null，垃圾回收机制就会释放掉。<br /></p>
<p><a name="OGj1A"></a></p>
<h1 id="示例-br"><a class="header-anchor" href="#示例-br">¶</a>示例<br /></h1>
<p>函数fatherFn 的子函数childFn，被函数fatherFn 外部的一个变量outerFn引用的时候，就创建了一个闭包。<br />在执行完 var outerFn = fatherFn() 后，变量outerFn实际上是指向了函数childFn，再执行outerFn() 后就会打印val的值(第一次为11)。这段代码其实就创建了一个闭包。因为 函数fatherFn 外的 变量outerFn 引用了 函数fatherFn 内的 函数childFn。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fatherFn</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> val = <span class="number">10</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">childFn</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    val += <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(val);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> outerFn = fatherFn();</span><br><span class="line">outerFn(); <span class="comment">// 11</span></span><br><span class="line">outerFn(); <span class="comment">// 12</span></span><br></pre></td></tr></table></figure>
<br />
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 正确的写法</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">father</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> array = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;<span class="number">10</span>; i++) &#123;</span><br><span class="line">    (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">var</span> j= i; <span class="comment">// 自由变量j</span></span><br><span class="line">      array[i] =  <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span>  j;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> array;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">father</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> array = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;<span class="number">10</span>; i++) &#123;</span><br><span class="line">    (<span class="function"><span class="keyword">function</span>(<span class="params">j</span>)</span>&#123;</span><br><span class="line">      <span class="comment">// 自由变量j</span></span><br><span class="line">      array[j] =  <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span>  j;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)(i)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> array;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 错误的写法 没有使用父级函数的局部变量</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">father</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> array = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">    <span class="comment">// 祖先函数的作用域</span></span><br><span class="line">    (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="comment">// 父级函数的作用域</span></span><br><span class="line">      array[i] =  <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> i;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> array;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 闭包</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)&#123;</span><br><span class="line">  (<span class="function"><span class="keyword">function</span> <span class="title">wrap</span>(<span class="params">i</span>)</span>&#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(i);</span><br><span class="line">    &#125;,<span class="number">1000</span>);</span><br><span class="line">  &#125;)(i)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 0到9</span></span><br></pre></td></tr></table></figure>
<br />
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 非闭包</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)&#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(i);</span><br><span class="line">  &#125;,<span class="number">1000</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 10个10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 非闭包</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)&#123;</span><br><span class="line">  <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span>=&gt;</span>&#123;</span><br><span class="line">    resolve();</span><br><span class="line">  &#125;).then(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(i);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 10个10</span></span><br></pre></td></tr></table></figure>
<br />
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 非闭包</span></span><br><span class="line"><span class="keyword">var</span> name = <span class="string">"The Window"</span>;</span><br><span class="line"><span class="keyword">var</span> object = &#123;</span><br><span class="line">  name : <span class="string">"My Object"</span>,</span><br><span class="line">  getNameFunc : <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(object.getNameFunc()()); <span class="comment">// The Window</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 闭包</span></span><br><span class="line"><span class="keyword">var</span> name = <span class="string">"The Window"</span>;</span><br><span class="line"><span class="keyword">var</span> object = &#123;</span><br><span class="line">  name : <span class="string">"My Object"</span>,</span><br><span class="line">  getNameFunc : <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// 使用 that 保存 this</span></span><br><span class="line">    <span class="keyword">var</span> that = <span class="keyword">this</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="comment">// 使用父级函数的局部变量 that</span></span><br><span class="line">      <span class="keyword">return</span> that.name;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(object.getNameFunc()()); <span class="comment">// My Object</span></span><br></pre></td></tr></table></figure>
<p><a name="Ey01l"></a></p>
<h1 id="过时的闭包"><a class="header-anchor" href="#过时的闭包">¶</a>过时的闭包</h1>
<p>过时的闭包捕获具有过时值的变量。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createIncrement</span>(<span class="params">i</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> value = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">increment</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    value += i;</span><br><span class="line">    <span class="built_in">console</span>.log(value);</span><br><span class="line">    <span class="comment">// message中的value对于 logValue函数 来说，已经不是父级函数的局部变量了。</span></span><br><span class="line">    <span class="keyword">var</span> message = <span class="string">`Current value is <span class="subst">$&#123;value&#125;</span>`</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">logValue</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(message);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> inc = createIncrement(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">var</span> log = inc(); <span class="comment">// 打印 1</span></span><br><span class="line">inc(); <span class="comment">// 打印 2</span></span><br><span class="line">inc(); <span class="comment">// 打印 3</span></span><br><span class="line"><span class="comment">// ⽆法正确⼯作，打印出错误的数据</span></span><br><span class="line">log(); <span class="comment">// 打印 "Current value is 1"</span></span><br></pre></td></tr></table></figure>
<p><br />在第一次调用inc()时，返回的闭包被分配给变量 log。对 inc() 的 3 次调用的增量 value 为 3。<br />最后，调用log() 打印 message “Current value is 1”，这是出乎意料的，因为此时 value 等于 3。<br /><br>
<br />log() 是过时的闭包。在第一次调用 inc() 时，闭包 log() 捕获了具有 “Current value is 1” 的 message 变量。而现在，当 value 已经是 3 时，message 变量已经过时了。<br /></p>
<p><a name="item-4"></a></p>
<h2 id="修复过时闭包的问题"><a class="header-anchor" href="#修复过时闭包的问题">¶</a>修复过时闭包的问题</h2>
<p><a name="xdXg1"></a></p>
<h4 id="使用新的闭包"><a class="header-anchor" href="#使用新的闭包">¶</a>使用新的闭包</h4>
<p>找到捕获了最新 message 变量的闭包。就是从最后一次调用 inc() 返回的闭包。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> inc = createIncrement(<span class="number">1</span>);</span><br><span class="line">inc();  <span class="comment">// 打印 1</span></span><br><span class="line">inc();  <span class="comment">// 打印 2</span></span><br><span class="line"><span class="keyword">var</span> latestLog = inc(); <span class="comment">// 打印 3</span></span><br><span class="line"><span class="comment">// 正常工作</span></span><br><span class="line">latestLog(); <span class="comment">// 打印 "Current value is 3"</span></span><br></pre></td></tr></table></figure>
<p><br />latestLog 捕获的 message 变量具有最新的的值 “Current value is 3”。<br />顺便说一下，这大概就是 React Hook 处理闭包新鲜度的方式。<br />Hooks 实现假设在组件重新渲染之间，作为 Hook 回调提供的最新闭包(例如 useEffect(callback)) 已经从组件的函数作用域捕获了最新的变量。<br /></p>
<p><a name="avvBC"></a></p>
<h4 id="关闭已更改的变量"><a class="header-anchor" href="#关闭已更改的变量">¶</a>关闭已更改的变量</h4>
<p>第二种方法是让logValue()直接使用 value。<br />让我们移动行 const message = …; 到 logValue() 函数体中：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createIncrementFixed</span>(<span class="params">i</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> value = <span class="number">0</span>;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">increment</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    value += i;</span><br><span class="line">    <span class="built_in">console</span>.log(value);</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">logValue</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> message = <span class="string">`Current value is <span class="subst">$&#123;value&#125;</span>`</span>;</span><br><span class="line">      <span class="built_in">console</span>.log(message);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> increment;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> inc = createIncrementFixed(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">var</span> log = inc(); <span class="comment">// 打印 1</span></span><br><span class="line">inc();             <span class="comment">// 打印 2</span></span><br><span class="line">inc();             <span class="comment">// 打印 3</span></span><br><span class="line"><span class="comment">// 正常工作</span></span><br><span class="line">log();             <span class="comment">// 打印 "Current value is 3"</span></span><br></pre></td></tr></table></figure>
<p><br />logValue() 关闭 createIncrementFixed() 作用域内的 value 变量。<br />log() 现在打印正确的消息“Current value is 3”。<br /><br>
<br /></p>
<p><a name="FDi4D"></a></p>
<h1 id="相关知识点"><a class="header-anchor" href="#相关知识点">¶</a>相关知识点</h1>
<p><a name="sLBRk"></a></p>
<h4 id="作用域"><a class="header-anchor" href="#作用域">¶</a>作用域</h4>
<p>内部环境可以通过作用域链访问所有的外部环境，但外部环境不能访问内部环境中的任何变量和函数。每个环境都可以向上搜索作用域链，但任何环境都不能向下搜索作用域链而进入另一个执行环境。<br /></p>
<p><a name="v0ItD"></a></p>
<h4 id="垃圾回收原理"><a class="header-anchor" href="#垃圾回收原理">¶</a>垃圾回收原理</h4>
<p>(1)javascript中如果一个对象不再被引用，那么这个对象就会被回收。<br />(2)如果两个对象互相引用，而不再被第3者引用，那么这两个互相引用的对象也会被回收。<br /></p>
<p><a name="1xPPq"></a></p>
<h4 id="内存泄漏"><a class="header-anchor" href="#内存泄漏">¶</a>内存泄漏</h4>
<p>产生原因：</p>
<ul>
<li>意外的全局变量</li>
<li>被遗忘的定时器或者回调</li>
<li>没有清理的Dom元素引用</li>
<li>闭包</li>
<li>IE7/8引用计数使用循环引用产生的问题</li>
</ul>
<p><br />解决办法：<br />1）减少不必要的全局变量，或者生命周期较长的对象，及时对无用的数据进行垃圾回收；<br />2）注意程序逻辑，避免“死循环”之类的 ；<br />3）避免创建过多的对象  原则：不用了的东西要及时归还。<br /><br>
<br /><br>
<br />参考<br /><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Closures" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Closures</a><br /><a href="https://www.ruanyifeng.com/blog/2009/08/learning_javascript_closures.html" target="_blank" rel="noopener">https://www.ruanyifeng.com/blog/2009/08/learning_javascript_closures.html</a><br /><a href="https://www.liaoxuefeng.com/wiki/1022910821149312/1023021250770016" target="_blank" rel="noopener">https://www.liaoxuefeng.com/wiki/1022910821149312/1023021250770016</a><br /><a href="https://www.runoob.com/js/js-function-closures.html" target="_blank" rel="noopener">https://www.runoob.com/js/js-function-closures.html</a><br /><a href="https://blog.csdn.net/webxiaoma/article/details/53213113" target="_blank" rel="noopener">https://blog.csdn.net/webxiaoma/article/details/53213113</a><br /><a href="https://segmentfault.com/a/1190000020805789?utm_source=tag-newest" target="_blank" rel="noopener">https://segmentfault.com/a/1190000020805789?utm_source=tag-newest</a><br /></p>

      
    </div>
    <footer class="article-footer">
      <!-- <a data-url="https://yansongcai.github.io/2020/09/08/bi-bao/" data-id="cketwfixv0000hbwq8uo88a9w" class="article-share-link">Share</a> -->
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-clone" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/09/06/clone/" class="article-date">
  <time datetime="2020-09-05T16:43:56.875Z" itemprop="datePublished">2020-09-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/09/06/clone/">深浅拷贝</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a name="lWdT6"></a></p>
<h1>javaScript的变量类型</h1>
<p>（1）基本类型：<br />5种基本数据类型undefined、null、Boolean、Number、String、Symbol，变量是直接存放值的，存放在栈内存中的简单数据段，可以直接访问。<br />（2）引用类型：<br />存放在堆内存中的对象，在栈内存中变量保存的是一个指针，这个指针指向堆内存中对应数据的地址。当需要访问引用类型（如对象，数组等）的值时，首先从栈中获得该对象的地址指针，然后再从堆内存中取得所需的数据。</p>
<p>JavaScript存储对象都是存地址的引用类型，所以浅拷贝会导致 obj1 和obj2 指向同一块内存地址。改变了其中一方的内容，都是在原来的内存上做修改会导致拷贝对象和源对象都发生改变。<br />而深拷贝是开辟一块新的内存地址，将原对象的各个属性逐个复制进去。对拷贝对象和源对象各自的操作互不影响。<br /></p>
<p><a name="Qf8B3"></a></p>
<h1>赋值、浅拷贝、深拷贝</h1>
<p>深拷贝：将 B 对象拷贝到 A 对象中，包括 B 里面的子对象，<br />浅拷贝：将 B 对象拷贝到 A 对象中，但不包括 B 里面的子对象</p>
<table>
<thead>
<tr>
<th></th>
<th>和原数据是否指向同一对象</th>
<th>第一层数据为基本数据类型</th>
<th>原数据中包含子对象</th>
</tr>
</thead>
<tbody>
<tr>
<td>赋值</td>
<td>是</td>
<td>改变会使原数据一同改变</td>
<td>改变会使原数据一同改变</td>
</tr>
<tr>
<td>浅拷贝</td>
<td>否</td>
<td>改变不会使原数据一同改变</td>
<td>改变会使原数据一同改变</td>
</tr>
<tr>
<td>深拷贝</td>
<td>否</td>
<td>改变不会使原数据一同改变</td>
<td>改变不会使原数据一同改变</td>
</tr>
</tbody>
</table>
<p><a name="0Iy9B"></a></p>
<h1>赋值</h1>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj1 = &#123;<span class="attr">a</span>:<span class="number">0</span>&#125;;</span><br><span class="line"><span class="keyword">const</span> obj2 = obj1;</span><br><span class="line"></span><br><span class="line">obj1 === obj2 <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<br />
<p><a name="nSlWC"></a></p>
<h1>浅拷贝</h1>
<p>拷贝原对象的实例，但是对其内部的引用类型值，拷贝的是其引用，常用的就是如</p>
<ul>
<li>jquey中的$.extend({}, obj);</li>
<li>Array.prototype.slice()</li>
<li>Array.prototype.concat()</li>
<li>Object.assign()</li>
<li>扩展运算符{ …obj }、[ …arr ]</li>
</ul>
<p>都会返回一个数组或者对象的浅拷贝</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 浅拷贝，双向改变,指向同一片内存空间</span></span><br><span class="line"><span class="keyword">var</span> arr1 = [&#123;<span class="attr">a</span>:<span class="number">0</span>&#125;, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="keyword">var</span> arr2 = &#123;...arr1&#125;;</span><br><span class="line"></span><br><span class="line">arr1 == arr2 <span class="comment">// false</span></span><br><span class="line">arr1 === arr2 <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line">arr1[<span class="number">0</span>] == arr2[<span class="number">0</span>] <span class="comment">// true</span></span><br><span class="line">arr1[<span class="number">0</span>] === arr2[<span class="number">0</span>] <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">clone</span>(<span class="params">arr</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> arr = [];</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; arr1.length; i++)&#123;</span><br><span class="line">    	arr.push(arr1[i]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> arr1 = [&#123; <span class="attr">a</span>: <span class="number">0</span> &#125;, <span class="number">1</span>, <span class="number">2</span>];</span><br><span class="line"><span class="keyword">var</span> arr2 = clone(arr1);</span><br><span class="line"></span><br><span class="line">arr1 == arr2 <span class="comment">// false</span></span><br><span class="line">arr1 === arr2 <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line">arr1[<span class="number">0</span>] == arr2[<span class="number">0</span>] <span class="comment">// true</span></span><br><span class="line">arr1[<span class="number">0</span>] === arr2[<span class="number">0</span>] <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p><br /><code>Object.assign()</code> 只对顶层属性做了赋值，完全没有继续做递归之类的把所有下一层的属性做深拷贝。只是一级属性复制。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;<span class="attr">a</span>:&#123;<span class="attr">aa</span>:&#123;<span class="attr">aaa</span>:<span class="number">1</span>&#125;&#125;&#125;</span><br><span class="line"><span class="keyword">var</span> obj1 = <span class="built_in">Object</span>.assign(&#123;&#125;,obj);</span><br><span class="line">obj == obj1 <span class="comment">// false</span></span><br><span class="line">obj.a == obj1.a <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = &#123;<span class="attr">a</span>:&#123;<span class="attr">aa</span>:&#123;<span class="attr">aaa</span>:<span class="number">1</span>&#125;&#125;&#125;</span><br><span class="line"><span class="keyword">var</span> obj1 = <span class="built_in">Object</span>.assign(&#123;&#125;,obj);</span><br><span class="line">obj.a === obj1.a <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p><br /> slice()</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> array = [&#123;<span class="attr">a</span>:<span class="number">100</span>&#125;, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line"><span class="keyword">var</span> copyArray = array.slice();</span><br><span class="line">array[<span class="number">0</span>] == copyArray[<span class="number">0</span>]</span><br><span class="line"><span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p><br />concat</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> array = [&#123;<span class="attr">a</span>:<span class="number">1</span>&#125;, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line"><span class="keyword">var</span> copyArray = array.concat();</span><br><span class="line">array[<span class="number">0</span>] == copyArray[<span class="number">0</span>]</span><br><span class="line"><span class="literal">true</span></span><br></pre></td></tr></table></figure>
<br />
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">shallowClone</span>(<span class="params">source</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> target = &#123;&#125;;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> i <span class="keyword">in</span> source) &#123;</span><br><span class="line">    <span class="keyword">if</span> (source.hasOwnProperty(i)) &#123;</span><br><span class="line">      target[i] = source[i];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> target;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<br />
<p><a name="e8fk7"></a></p>
<h1>深拷贝</h1>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 生成测试需要的数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createData</span>(<span class="params">deep, breadth</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> data = &#123;&#125;;</span><br><span class="line">  <span class="keyword">var</span> temp = data;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; deep; i++) &#123;</span><br><span class="line">    temp = temp[<span class="string">'data'</span>] = &#123;&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; breadth; j++) &#123;</span><br><span class="line">      temp[j] = j;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> data;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br />测试用例</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> testObj = &#123;</span><br><span class="line">  num: <span class="number">10</span>,</span><br><span class="line">  str: <span class="string">'str'</span>,</span><br><span class="line">  arr: [</span><br><span class="line">    <span class="number">10</span>,</span><br><span class="line">    &#123;</span><br><span class="line">      arrObjA:<span class="number">10</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">  sy:<span class="built_in">Symbol</span>(<span class="string">''</span>),</span><br><span class="line">  da:<span class="keyword">new</span> <span class="built_in">Date</span>(),</span><br><span class="line">  fn:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;,</span><br><span class="line">  reg: <span class="regexp">/test/</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><a name="HeNtB"></a></p>
<h2>JSON.stringify() 和 JSON.parse()</h2>
<p>1.无法实现对 函数、RegExp、Date等 特殊对象的克隆<br />2.会抛弃对象的constructor,所有的构造函数会指向Object<br />3.对象有循环引用,会报错</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj1 = &#123;</span><br><span class="line">  name: <span class="string">'wayne'</span>, </span><br><span class="line">  age: <span class="number">22</span>,</span><br><span class="line">  other: &#123;</span><br><span class="line">    hobby: <span class="string">'table'</span>,</span><br><span class="line">    school: <span class="string">'xjtu'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> obj2 = <span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(obj1));</span><br><span class="line">obj2.name = <span class="string">'hedy'</span></span><br><span class="line"><span class="built_in">console</span>.log(obj1.name) <span class="comment">// wayne</span></span><br><span class="line">obj2.other.hobby = <span class="string">'sing'</span></span><br><span class="line"><span class="built_in">console</span>.log(obj1.other.hobby) <span class="comment">// table</span></span><br></pre></td></tr></table></figure>
<p><br />可以看出通过JSON.stringify先将对象转化为字符换，然后再通过JSON.parse()转化为对象，这个对象就是完全在开辟的新的内存空间中的对象 。</p>
<p><a name="bmuov"></a></p>
<h2>递归</h2>
<p>简版</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 深拷贝</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;any&#125;</span> <span class="variable">obj</span></span></span></span><br><span class="line"><span class="comment"> * 其中：function、symbol直接返回了原来的值;</span></span><br><span class="line"><span class="comment"> * 循环引用会报错</span></span><br><span class="line"><span class="comment"> * 数据深度过大会存在爆栈</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">deepClone</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 判断类型，根据不同类型进行处理</span></span><br><span class="line">  <span class="keyword">if</span>(obj === <span class="literal">null</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">typeof</span> obj !== <span class="string">'object'</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> obj;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(obj <span class="keyword">instanceof</span> <span class="built_in">RegExp</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">RegExp</span>(obj)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(obj <span class="keyword">instanceof</span> <span class="built_in">Date</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Date</span>(obj)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 不直接创建空对象目的是，克隆的结果和之前保持相同的所属类</span></span><br><span class="line">  <span class="keyword">let</span> newObj = <span class="keyword">new</span> obj.constructor(); <span class="comment">// 为了防止obj是个实例</span></span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">let</span> key <span class="keyword">in</span> obj) &#123;</span><br><span class="line">    <span class="comment">// 递归克隆</span></span><br><span class="line">    newObj[key] = deepClone(obj[key]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> newObj;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 深拷贝</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;any&#125;</span> <span class="variable">obj</span></span></span></span><br><span class="line"><span class="comment"> * 其中：function、symbol直接返回了原来的值;</span></span><br><span class="line"><span class="comment"> * 数据深度过大会存在爆栈</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">deepClone</span>(<span class="params">obj, parent</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> _parent = parent;</span><br><span class="line">    <span class="keyword">var</span> objType = getType(obj);</span><br><span class="line">    <span class="keyword">var</span> newObj = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (objType !== <span class="string">'object'</span> &amp;&amp; objType !== <span class="string">'array'</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 该字段有父级则需要追溯该字段的父级，判断是否为循环引用</span></span><br><span class="line">    <span class="keyword">while</span> (_parent) &#123;</span><br><span class="line">        <span class="comment">// 如果该字段引用了它的父级，则为循环引用</span></span><br><span class="line">        <span class="keyword">if</span> (_parent.originParent === obj) &#123;</span><br><span class="line">            <span class="comment">// 循环引用返回同级的新对象</span></span><br><span class="line">            <span class="keyword">return</span> _parent.currentParent;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 向上追溯父级</span></span><br><span class="line">        _parent = _parent.parent</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (objType === <span class="string">'array'</span>) &#123;</span><br><span class="line">        newObj = [];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> obj) &#123;</span><br><span class="line">        <span class="keyword">if</span> (obj.hasOwnProperty(key)) &#123;</span><br><span class="line">            <span class="keyword">var</span> item = obj[key];</span><br><span class="line">            <span class="keyword">var</span> itemType = getType(item);</span><br><span class="line">            <span class="keyword">if</span> (itemType === <span class="string">'object'</span> || itemType === <span class="string">'array'</span>) &#123;</span><br><span class="line">                newObj[key] = deepClone(item, &#123;</span><br><span class="line">                    <span class="comment">// 递归执行深拷贝，将同级的待拷贝对象与新对象传递给parent，方便追溯循环引用</span></span><br><span class="line">                    <span class="comment">// 源对象父级，用于判断是否引用了他的父级</span></span><br><span class="line">                    originParent: obj,</span><br><span class="line">                    <span class="comment">// 新的对象父级，用于存在循环引用时的返回值</span></span><br><span class="line">                    currentParent: newObj,</span><br><span class="line">                    <span class="comment">// 父级对象，按照层级存放所有的源对象父级</span></span><br><span class="line">                    parent: parent</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (itemType === <span class="string">'date'</span>) &#123;</span><br><span class="line">                newObj[key] = <span class="keyword">new</span> <span class="built_in">Date</span>(item);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (itemType === <span class="string">'regexp'</span>) &#123;</span><br><span class="line">                newObj[key] = <span class="keyword">new</span> <span class="built_in">RegExp</span>(item);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (itemType === <span class="string">'function'</span>) &#123;</span><br><span class="line">                <span class="comment">// <span class="doctag">TODO:</span></span></span><br><span class="line">                newObj[key] = item;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (itemType === <span class="string">'symbol'</span>) &#123;</span><br><span class="line">                <span class="comment">// <span class="doctag">TODO:</span></span></span><br><span class="line">                newObj[key] = item;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                newObj[key] = item;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> newObj;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 判断数据的类型</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;any&#125;</span> <span class="variable">obj</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getType</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Object</span>.prototype.toString.call(obj).replace(<span class="regexp">/^\[object (.+)\]$/</span>, <span class="string">'$1'</span>).toLowerCase();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a name="tfKAd"></a></p>
<h2>循环</h2>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 深拷贝</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>obj 需要深拷贝的对象</span></span><br><span class="line"><span class="comment"> * 使用循环模拟栈，防止数据深度过大导致爆栈;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">deepClone</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 用来去重</span></span><br><span class="line">    <span class="keyword">var</span> uniqueList = [];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置最外层的根对象</span></span><br><span class="line">    <span class="keyword">var</span> root = &#123;&#125;;</span><br><span class="line">    <span class="keyword">if</span> (getType(obj) === <span class="string">'array'</span>) &#123;</span><br><span class="line">        root = [];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 栈</span></span><br><span class="line">    <span class="keyword">var</span> loopList = [</span><br><span class="line">        &#123;</span><br><span class="line">            parent: root,</span><br><span class="line">            <span class="comment">// 存储data在父级对应的key</span></span><br><span class="line">            key: <span class="literal">undefined</span>,</span><br><span class="line">          	<span class="comment">// 当前要处理的数据</span></span><br><span class="line">            data: obj,</span><br><span class="line">        &#125;</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (loopList.length) &#123;</span><br><span class="line">        <span class="keyword">var</span> node = loopList.pop();</span><br><span class="line">        <span class="keyword">var</span> parent = node.parent;</span><br><span class="line">        <span class="keyword">var</span> key = node.key;</span><br><span class="line">        <span class="keyword">var</span> data = node.data;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 初始化赋值目标，key为 undefined 则拷贝到父元素，否则拷贝到子元素</span></span><br><span class="line">        <span class="keyword">var</span> res = parent;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> key !== <span class="string">'undefined'</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (getType(data) === <span class="string">'array'</span>) &#123;</span><br><span class="line">                res = parent[key] = [];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                res = parent[key] = &#123;&#125;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 数据已经存在</span></span><br><span class="line">        <span class="keyword">var</span> uniqueData = getItemFromArr(uniqueList, data);</span><br><span class="line">        <span class="keyword">if</span> (uniqueData) &#123;</span><br><span class="line">            parent[key] = uniqueData.target;</span><br><span class="line">            <span class="keyword">break</span>; <span class="comment">// 中断本次循环</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 数据不存在</span></span><br><span class="line">        <span class="comment">// 保存源数据，在拷贝数据中对应的引用</span></span><br><span class="line">        uniqueList.push(&#123;</span><br><span class="line">            source: data,</span><br><span class="line">            target: res,</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 广度优先 处理</span></span><br><span class="line">        <span class="comment">// 遍历当前对象的子项(只遍历第一层，如果子项的值是对象，则保存到栈里面)</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> data) &#123;</span><br><span class="line">            <span class="keyword">if</span> (data.hasOwnProperty(key)) &#123;</span><br><span class="line">                <span class="keyword">var</span> item = data[key];</span><br><span class="line">                <span class="keyword">var</span> itemType = getType(item);</span><br><span class="line">                <span class="keyword">switch</span> (itemType) &#123;</span><br><span class="line">                    <span class="comment">// 对象和数组进行 下一次循环</span></span><br><span class="line">                    <span class="keyword">case</span> <span class="string">'object'</span>:</span><br><span class="line">                    <span class="keyword">case</span> <span class="string">'array'</span>:</span><br><span class="line">                        loopList.push(&#123;</span><br><span class="line">                            parent: res,</span><br><span class="line">                            key: key,</span><br><span class="line">                            data: item,</span><br><span class="line">                        &#125;);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> <span class="string">'date'</span>:</span><br><span class="line">                        res[key] = <span class="keyword">new</span> <span class="built_in">Date</span>(item);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> <span class="string">'regexp'</span>:</span><br><span class="line">                        res[key] = <span class="keyword">new</span> <span class="built_in">RegExp</span>(item);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> <span class="string">'function'</span>:</span><br><span class="line">                        <span class="comment">// <span class="doctag">TODO:</span></span></span><br><span class="line">                        res[key] = item;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> <span class="string">'symbol'</span>:</span><br><span class="line">                        <span class="comment">// <span class="doctag">TODO:</span></span></span><br><span class="line">                        res[key] = item;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">default</span>:</span><br><span class="line">                        res[key] = item;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> root;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 从数组里面获取数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Array&#125;</span> </span>arr </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;any&#125;</span> </span>item </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getItemFromArr</span>(<span class="params">arr, item</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (arr[i].source === item) &#123;</span><br><span class="line">            <span class="keyword">return</span> arr[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 判断数据的类型</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;any&#125;</span> <span class="variable">obj</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getType</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Object</span>.prototype.toString.call(obj).replace(<span class="regexp">/^\[object (.+)\]$/</span>, <span class="string">'$1'</span>).toLowerCase();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<br />
<p><a name="jakET"></a></p>
<h2>测试</h2>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 测试</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createData</span>(<span class="params">deep, breadth</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> data = &#123;&#125;;</span><br><span class="line">    <span class="keyword">var</span> temp = data;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; deep; i++) &#123;</span><br><span class="line">        temp = temp[<span class="string">'data'</span>] = &#123;&#125;;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; breadth; j++) &#123;</span><br><span class="line">            temp[j] = j;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> data;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">testDeepClone</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> cloneLoop(obj);</span><br><span class="line">    <span class="comment">// return deepClone(obj);</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> arr1 = [</span><br><span class="line">    <span class="number">0</span>,</span><br><span class="line">    &#123; <span class="attr">a</span>: &#123; <span class="attr">aa</span>: &#123; <span class="attr">aaa</span>: &#123;&#125; &#125; &#125; &#125;,</span><br><span class="line">    <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="string">'2019/1/2 3:4:5'</span>),</span><br><span class="line">    /<span class="number">1</span>/g,</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>) </span>&#123; <span class="built_in">console</span>.log(<span class="keyword">this</span>, <span class="string">'function'</span>); <span class="keyword">return</span> <span class="string">'a'</span>; &#125;,</span><br><span class="line">    () =&gt; &#123; <span class="built_in">console</span>.log(<span class="keyword">this</span>, <span class="string">'()=&gt;&#123;&#125;'</span>); <span class="keyword">return</span> <span class="string">'()'</span>; &#125;,</span><br><span class="line">    <span class="built_in">Symbol</span>(<span class="number">10</span>),</span><br><span class="line">    [<span class="number">1</span>, <span class="number">2</span>, &#123; <span class="attr">a</span>: <span class="number">3</span> &#125;]</span><br><span class="line">];</span><br><span class="line"><span class="keyword">var</span> arr2 = testDeepClone(arr1);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(arr2);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; arr1.length; i++) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(i, arr1[i], getType(arr1[i]), getType(arr2[i]), arr1[i] == arr2[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(arr2[<span class="number">4</span>]);</span><br><span class="line"><span class="built_in">console</span>.log(arr1[<span class="number">4</span>](), arr2[<span class="number">4</span>](), arr1[<span class="number">4</span>] == arr2[<span class="number">4</span>]);</span><br><span class="line"><span class="built_in">console</span>.log(arr1[<span class="number">5</span>]);</span><br><span class="line"><span class="built_in">console</span>.log(arr2[<span class="number">5</span>]);</span><br><span class="line"><span class="built_in">console</span>.log(arr1[<span class="number">5</span>](), arr2[<span class="number">5</span>](), arr1[<span class="number">5</span>] == arr2[<span class="number">5</span>]);</span><br><span class="line"><span class="built_in">console</span>.log(arr1[<span class="number">7</span>][<span class="number">2</span>] == arr2[<span class="number">7</span>][<span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = &#123;&#125;</span><br><span class="line"><span class="keyword">var</span> b = &#123;&#125;</span><br><span class="line">a[<span class="string">'b'</span>] = b</span><br><span class="line">b[<span class="string">'a'</span>] = a</span><br><span class="line"><span class="keyword">var</span> c = testDeepClone(a);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'a'</span>, a, <span class="string">'b'</span>, b, <span class="string">'c'</span>, c);</span><br><span class="line"><span class="built_in">console</span>.log(c.b.a, a.b.a, c.b.a === a.b.a);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 父级引用</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 父级引用指的是，当对象的某个属性，正是这个对象本身，此时我们如果进行深拷贝，可能会在子元素-&gt;父对象-&gt;子元素...这个循环中一直进行，导致栈溢出。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj1 = &#123;</span><br><span class="line">    x: <span class="number">1</span>,</span><br><span class="line">    y: <span class="number">2</span></span><br><span class="line">&#125;;</span><br><span class="line">obj1.z = obj1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj2 = testDeepClone(obj1); <span class="comment">// 栈溢出</span></span><br><span class="line"><span class="built_in">console</span>.log(obj2);</span><br><span class="line"><span class="built_in">console</span>.log(obj2.z.z === obj1.z.z);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 同级引用</span></span><br><span class="line"><span class="comment"> * 假设对象obj有a,b,c三个子对象，其中子对象c中有个属性d引用了对象obj下面的子对象a。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> obj3 = &#123;</span><br><span class="line">    a: &#123;</span><br><span class="line">        name: &#123;&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    b: &#123;</span><br><span class="line">        name: &#123;&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    c: &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">obj3.c.e = obj3.a;</span><br><span class="line"><span class="keyword">var</span> obj4 = testDeepClone(obj3);</span><br><span class="line"><span class="built_in">console</span>.log(obj4, obj4.c.e.name === obj3.c.e.name);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj5 = &#123;</span><br><span class="line">    aa: &#123;</span><br><span class="line">        aaa: &#123;</span><br><span class="line">            n: <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    ab: &#123;</span><br><span class="line">        abb: &#123;</span><br><span class="line">            n: <span class="number">2</span></span><br><span class="line">        &#125;,</span><br><span class="line">        abc: &#123;</span><br><span class="line">            n: <span class="number">3</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">obj5.ab.abc = obj5.aa.aaa;</span><br><span class="line">obj5.aa.aaa = obj5.ab.abb;</span><br><span class="line"><span class="keyword">var</span> obj6 = testDeepClone(obj5);</span><br><span class="line"><span class="built_in">console</span>.log(obj6);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(testDeepClone(createData(<span class="number">10000</span>))); <span class="comment">// Maximum call stack size exceeded</span></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <!-- <a data-url="https://yansongcai.github.io/2020/09/06/clone/" data-id="ckepweb0q0000wiwq7rye1zjz" class="article-share-link">Share</a> -->
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-test-img" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/09/05/test-img/" class="article-date">
  <time datetime="2020-09-05T03:19:58.333Z" itemprop="datePublished">2020-09-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/09/05/test-img/">test img</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>test img<br><a href="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=3770410044,1864591641&amp;fm=26&amp;gp=0.jpg" target="_blank" rel="noopener">https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=3770410044,1864591641&amp;fm=26&amp;gp=0.jpg</a><br><img src="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=3770410044,1864591641&fm=26&gp=0.jpg" alt="Alt text" title="optional title"></p>

      
    </div>
    <footer class="article-footer">
      <!-- <a data-url="https://yansongcai.github.io/2020/09/05/test-img/" data-id="ckep3n45t0001uuwq14cefokl" class="article-share-link">Share</a> -->
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-null-page" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/09/04/null-page/" class="article-date">
  <time datetime="2020-09-04T15:27:35.893Z" itemprop="datePublished">2020-09-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/09/04/null-page/">null page</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>null page</p>

      
    </div>
    <footer class="article-footer">
      <!-- <a data-url="https://yansongcai.github.io/2020/09/04/null-page/" data-id="ckeoe6y7h000beywqhf2pfoc6" class="article-share-link">Share</a> -->
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-测试" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/09/04/ce-shi/" class="article-date">
  <time datetime="2020-09-04T15:26:01.971Z" itemprop="datePublished">2020-09-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/09/04/ce-shi/">测试</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>中文文件名测试</p>

      
    </div>
    <footer class="article-footer">
      <!-- <a data-url="https://yansongcai.github.io/2020/09/04/ce-shi/" data-id="ckeqhr81y00003jwq2daa43ud" class="article-share-link">Share</a> -->
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-test" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/09/04/test/" class="article-date">
  <time datetime="2020-09-04T13:47:29.415Z" itemprop="datePublished">2020-09-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/09/04/test/">test</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>test</p>

      
    </div>
    <footer class="article-footer">
      <!-- <a data-url="https://yansongcai.github.io/2020/09/04/test/" data-id="ckeoam53g00020owqc1t2ca3o" class="article-share-link">Share</a> -->
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-hello-world" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/04/11/hello-world/" class="article-date">
  <time datetime="2020-04-11T06:19:39.790Z" itemprop="datePublished">2020-04-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/04/11/hello-world/">Hello World</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html" target="_blank" rel="noopener">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <!-- <a data-url="https://yansongcai.github.io/2020/04/11/hello-world/" data-id="ckenzl7i2000025wq76soh6du" class="article-share-link">Share</a> -->
      
      
    </footer>
  </div>
  
</article>


  


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">九月 2020</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">四月 2020</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/09/08/bi-bao/">闭包</a>
          </li>
        
          <li>
            <a href="/2020/09/06/clone/">深浅拷贝</a>
          </li>
        
          <li>
            <a href="/2020/09/05/test-img/">test img</a>
          </li>
        
          <li>
            <a href="/2020/09/04/null-page/">null page</a>
          </li>
        
          <li>
            <a href="/2020/09/04/ce-shi/">测试</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 蔡延松<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/archives" class="mobile-nav-link">列表</a>
  
    <a href="/about" class="mobile-nav-link">关于</a>
  
</nav>
    

<script src="https://cdn.bootcss.com/jquery/2.2.0/jquery.min.js"></script>
<script src="/js/search.js"></script>


  
<link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.css">

  
<script src="https://cdn.bootcdn.net/ajax/libs/fancybox/2.1.5/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>